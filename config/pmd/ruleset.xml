<?xml version="1.0"?>
<ruleset name="board-hole-pmd-rules"
         xmlns="http://pmd.sourceforge.net/ruleset/2.0.0"
         xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
         xsi:schemaLocation="http://pmd.sourceforge.net/ruleset/2.0.0 https://pmd.sourceforge.io/ruleset_2_0_0.xsd">

    <description>엄격한 PMD 룰셋 for Board Hole 프로젝트 - 교과서적 품질 표준</description>

    <!-- Best Practices - 엄격한 모범 사례 적용 -->
    <rule ref="category/java/bestpractices.xml"/>

    <!-- Code Style - 엄격한 코드 스타일 -->
    <rule ref="category/java/codestyle.xml">
        <!-- Spring/Lombok과 충돌하는 규칙만 제외 -->
        <exclude name="AtLeastOneConstructor"/>  <!-- Lombok @NoArgsConstructor -->
        <exclude name="CommentDefaultAccessModifier"/>  <!-- package-private는 의도적 -->
    </rule>

    <!-- Design - 엄격한 설계 원칙 -->
    <rule ref="category/java/design.xml">
        <!-- 엔터프라이즈 환경에서 불가피한 규칙만 제외 -->
        <exclude name="LoosePackageCoupling"/>  <!-- 도메인 간 결합은 불가피 -->
    </rule>

    <!-- Documentation - 문서화 강제 -->
    <rule ref="category/java/documentation.xml"/>

    <!-- Error Prone - 오류 가능성 제거 -->
    <rule ref="category/java/errorprone.xml"/>

    <!-- Multithreading - 동시성 안전성 -->
    <rule ref="category/java/multithreading.xml"/>

    <!-- Performance - 성능 최적화 -->
    <rule ref="category/java/performance.xml"/>

    <!-- Security - 보안 강화 -->
    <rule ref="category/java/security.xml"/>

    <!-- 엄격한 복잡도 제한 -->
    <rule ref="category/java/design.xml/CyclomaticComplexity">
        <properties>
            <property name="methodReportLevel" value="7"/>   <!-- 교과서 표준: 7 이하 -->
            <property name="classReportLevel" value="25"/>   <!-- 교과서 표준: 25 이하 -->
        </properties>
    </rule>

    <!-- 인지 복잡도 제한 -->
    <rule ref="category/java/design.xml/CognitiveComplexity">
        <properties>
            <property name="reportLevel" value="10"/>  <!-- 교과서 표준: 10 이하 -->
        </properties>
    </rule>

    <!-- 메서드 개수 제한 -->
    <rule ref="category/java/design.xml/TooManyMethods">
        <properties>
            <property name="maxmethods" value="15"/>  <!-- 교과서 표준: 15개 이하 -->
        </properties>
    </rule>

    <!-- 필드 개수 제한 -->
    <rule ref="category/java/design.xml/TooManyFields">
        <properties>
            <property name="maxfields" value="10"/>  <!-- 교과서 표준: 10개 이하 -->
        </properties>
    </rule>

    <!-- 매개변수 개수 제한 -->
    <rule ref="category/java/design.xml/ExcessiveParameterList">
        <properties>
            <property name="minimum" value="5"/>  <!-- 교과서 표준: 5개 이하 -->
        </properties>
    </rule>

    <!-- 메서드 길이 제한 -->
    <rule ref="category/java/design.xml/NPathComplexity">
        <properties>
            <property name="reportLevel" value="200"/>
        </properties>
    </rule>

    <!-- 클래스 길이 제한 -->
    <rule ref="category/java/design.xml/ExcessivePublicCount">
        <properties>
            <property name="minimum" value="20"/>
        </properties>
    </rule>

    <!-- 컨트롤러에서 ResponseEntity 사용 금지 -->
    <rule name="NoResponseEntityInController"
          message="컨트롤러에서 ResponseEntity를 직접 반환하지 마세요. @ResponseStatus나 ResponseBodyAdvice를 사용하세요."
          language="java"
          class="net.sourceforge.pmd.lang.rule.xpath.XPathRule">
        <properties>
            <property name="xpath" value="//ClassDeclaration[.//Annotation[@SimpleName='Controller' or @SimpleName='RestController']]//MethodDeclaration//Type//ClassType[@SimpleName='ResponseEntity']"/>
        </properties>
        <priority>1</priority>
    </rule>

</ruleset>