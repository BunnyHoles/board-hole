# Internationalization (i18n) Guide

Board-Hole 프로젝트의 다국어 지원 시스템 가이드

## 📋 Table of Contents

- [Overview](#overview)
- [Supported Languages](#supported-languages)
- [How it Works](#how-it-works)
- [Using Internationalization](#using-internationalization)
- [Adding New Languages](#adding-new-languages)
- [Message Key Conventions](#message-key-conventions)
- [Development Guidelines](#development-guidelines)

## 🌍 Overview

Board-Hole은 Spring의 `MessageSource`를 활용한 완전한 다국어 지원 시스템을 제공합니다.

### Key Features

- 🔄 **Dynamic Language Switching**: 요청별 언어 변경 가능
- 📝 **Comprehensive Coverage**: 에러 메시지, 로그, 유효성 검증 메시지 모두 지원
- ⚡ **Performance Optimized**: 메시지 캐싱으로 성능 최적화
- 🛡️ **Fallback Support**: 메시지 누락 시 안전한 fallback

## 🗣️ Supported Languages

| Language | Code | Status | Coverage |
|----------|------|--------|----------|
| 한국어 | `ko` | ✅ Complete | 100% |
| English | `en` | ✅ Complete | 100% |
| 日本語 | `ja` | 🚧 Planned | 0% |
| 中文 | `zh` | 🚧 Planned | 0% |

## ⚙️ How it Works

### System Architecture

```
Client Request (?lang=en)
       ↓
LocaleChangeInterceptor
       ↓
LocaleContextHolder.setLocale(en)
       ↓
MessageUtils.getMessage(key)
       ↓
MessageSource.getMessage(key, args, locale)
       ↓
messages_en.properties
```

### Configuration

```java
@Configuration
public class InternationalizationConfig implements WebMvcConfigurer {
    
    @Bean
    public MessageSource messageSource() {
        ReloadableResourceBundleMessageSource messageSource = 
            new ReloadableResourceBundleMessageSource();
        messageSource.setBasenames(
            "classpath:messages",           // 일반 메시지
            "classpath:ValidationMessages"  // 유효성 검증 메시지
        );
        messageSource.setDefaultEncoding("UTF-8");
        messageSource.setDefaultLocale(Locale.KOREAN);  // 기본값: 한국어
        return messageSource;
    }
    
    @Bean
    public LocaleChangeInterceptor localeChangeInterceptor() {
        LocaleChangeInterceptor interceptor = new LocaleChangeInterceptor();
        interceptor.setParamName("lang");  // ?lang=en 파라미터 사용
        return interceptor;
    }
}
```

## 🎯 Using Internationalization

### Query Parameter Method

모든 API 요청에 `lang` 파라미터를 추가하세요:

```bash
# 한국어 (기본값)
curl "http://localhost:8080/api/boards/999"
# 응답: "게시글을 찾을 수 없습니다. ID: 999"

# 영어
curl "http://localhost:8080/api/boards/999?lang=en"  
# 응답: "Board not found with ID: 999"
```

### HTTP Header Method (향후 지원)

```http
GET /api/boards/999
Accept-Language: en-US,en;q=0.9,ko;q=0.8
```

### Frontend Integration

#### JavaScript/Fetch
```javascript
// 현재 언어 설정 저장
const currentLang = localStorage.getItem('language') || 'ko';

// API 요청 시 자동으로 언어 파라미터 추가
function apiRequest(url, options = {}) {
    const separator = url.includes('?') ? '&' : '?';
    const fullUrl = `${url}${separator}lang=${currentLang}`;
    
    return fetch(fullUrl, {
        ...options,
        headers: {
            'Content-Type': 'application/json',
            'Authorization': `Bearer ${getToken()}`,
            ...options.headers
        }
    });
}

// 사용 예시
apiRequest('/api/boards/1')
    .then(response => response.json())
    .then(data => console.log(data))
    .catch(error => console.error('Error:', error));
```

#### React Example
```jsx
// Language context
const LanguageContext = createContext();

function LanguageProvider({ children }) {
    const [language, setLanguage] = useState('ko');
    
    const apiCall = useCallback((url, options = {}) => {
        const separator = url.includes('?') ? '&' : '?';
        return fetch(`${url}${separator}lang=${language}`, options);
    }, [language]);
    
    return (
        <LanguageContext.Provider value={{ language, setLanguage, apiCall }}>
            {children}
        </LanguageContext.Provider>
    );
}
```

## 🆕 Adding New Languages

### Step 1: Create Message Files

새로운 언어를 추가하려면 메시지 파일을 생성하세요:

```bash
# 일본어 추가 예시
touch src/main/resources/messages_ja.properties
touch src/main/resources/ValidationMessages_ja.properties
```

### Step 2: Translate Messages

**messages_ja.properties**:
```properties
# Error messages Japanese
error.user.not-found=ユーザーが見つかりません。ID: {0}
error.board.not-found=ボードが見つかりません。ID: {0}
error.username.duplicate=ユーザー名は既に使用されています
error.email.duplicate=メールアドレスは既に使用されています
error.authentication.invalid=無効なユーザー名またはパスワードです
error.authentication.required=認証が必要です
error.access.denied=アクセスが拒否されました
error.validation.failed=バリデーションに失敗しました

# Exception titles Japanese
exception.title.not-found=リソースが見つかりません
exception.title.unauthorized=認証失敗
exception.title.access-denied=アクセス拒否

# Log messages Japanese  
log.request.start=🌐 リクエスト開始: {0} {1} (IP: {2})
log.request.end=🏁 リクエスト完了: {0} {1} [ステータス: {2}] ({3}ms)
```

### Step 3: Test New Language

```bash
# 일본어 메시지 테스트
curl "http://localhost:8080/api/boards/999?lang=ja"
```

### Step 4: Update Documentation

새로운 언어를 지원 언어 목록에 추가하고 README.md를 업데이트하세요.

## 🔑 Message Key Conventions

### Key Naming Structure

```
{category}.{subcategory}.{specific-case}
```

### Error Messages
```properties
# Format: error.{domain}.{error-type}
error.user.not-found=사용자를 찾을 수 없습니다. ID: {0}
error.board.not-found=게시글을 찾을 수 없습니다. ID: {0}
error.authentication.invalid=잘못된 사용자명 또는 비밀번호입니다
error.validation.failed=입력값 검증에 실패했습니다

# Exception titles
exception.title.not-found=리소스를 찾을 수 없음
exception.title.unauthorized=인증 실패
```

### Log Messages
```properties
# Format: log.{component}.{action}
log.request.start=🌐 요청 시작: {0} {1} (IP: {2})
log.request.end=🏁 요청 완료: {0} {1} [상태: {2}] ({3}ms)
log.method.start=📥 메소드 시작: {0}({1})
log.method.end=📤 메소드 완료: {0} = {1} ({2}ms)
```

### Validation Messages
```properties
# Format: validation.{field}.{constraint}
validation.board.title.required=게시글 제목은 필수입니다
validation.board.title.size=게시글 제목은 {max}자 이하여야 합니다
validation.board.content.required=게시글 내용은 필수입니다
validation.user.email.invalid=올바른 이메일 형식이 아닙니다
```

### Utility Messages
```properties
# Format: {category}.{item}.{property}
mask.password=🔒비밀번호:***
mask.token=🎫토큰:***
mask.secret=🔐비밀키:***
```

## 👨‍💻 Development Guidelines

### Using Messages in Code

#### Exception Handling
```java
// MessageUtils 사용 (권장)
throw new ResourceNotFoundException(
    MessageUtils.getMessageStatic("error.board.not-found", boardId)
);

// 직접 MessageSource 사용
@Service
@RequiredArgsConstructor
public class BoardService {
    private final MessageSource messageSource;
    
    public void validateBoard(Long id) {
        String message = messageSource.getMessage(
            "error.board.not-found", 
            new Object[]{id}, 
            LocaleContextHolder.getLocale()
        );
        throw new ResourceNotFoundException(message);
    }
}
```

#### Validation Messages
```java
public class BoardCreateRequest {
    
    @NotBlank(message = "{validation.board.title.required}")
    @Size(max = 200, message = "{validation.board.title.size}")
    private String title;
    
    @NotBlank(message = "{validation.board.content.required}")
    @Size(max = 10000, message = "{validation.board.content.size}")
    private String content;
}
```

#### Log Messages
```java
@Component
@Slf4j
public class LoggingAspect {
    
    @Around("@annotation(LogExecutionTime)")
    public Object logExecutionTime(ProceedingJoinPoint joinPoint) throws Throwable {
        String methodName = joinPoint.getSignature().getName();
        Object[] args = joinPoint.getArgs();
        
        // 시작 로그 (다국어)
        String startMessage = MessageUtils.getMessageStatic(
            "log.method.start", methodName, Arrays.toString(args)
        );
        log.info(startMessage);
        
        long startTime = System.currentTimeMillis();
        Object result = joinPoint.proceed();
        long executionTime = System.currentTimeMillis() - startTime;
        
        // 완료 로그 (다국어)
        String endMessage = MessageUtils.getMessageStatic(
            "log.method.end", methodName, result, executionTime
        );
        log.info(endMessage);
        
        return result;
    }
}
```

### Message Parameter Guidelines

#### Parameter Ordering
메시지 파라미터는 논리적 순서로 배치:

```properties
# ✅ Good: 자연스러운 순서
error.user.access.denied=사용자 {0}이 리소스 {1}에 접근할 수 없습니다
log.request.complete=요청 {0} {1}이 {2}ms 만에 완료되었습니다 (상태: {3})

# ❌ Bad: 부자연스러운 순서
error.user.access.denied=리소스 {1}에 사용자 {0}이 접근할 수 없습니다
```

#### Parameter Types
```properties
# 문자열 파라미터
error.user.not-found=사용자 {0}을 찾을 수 없습니다

# 숫자 파라미터
validation.title.size=제목은 {0}자 이상 {1}자 이하여야 합니다

# 날짜 파라미터 (SimpleDateFormat 사용)
log.backup.complete=백업이 {0,date,yyyy-MM-dd HH:mm:ss}에 완료되었습니다

# 숫자 포맷팅
log.performance.memory=메모리 사용량: {0,number,percent}
```

### Testing Internationalization

```java
@Test
void testInternationalizedMessages() {
    // 한국어 테스트
    Locale.setDefault(Locale.KOREAN);
    LocaleContextHolder.setLocale(Locale.KOREAN);
    
    String koreanMessage = MessageUtils.getMessageStatic("error.board.not-found", 1L);
    assertThat(koreanMessage).contains("게시글을 찾을 수 없습니다");
    
    // 영어 테스트
    LocaleContextHolder.setLocale(Locale.ENGLISH);
    String englishMessage = MessageUtils.getMessageStatic("error.board.not-found", 1L);
    assertThat(englishMessage).contains("Board not found");
}

@TestMethodOrder(OrderAnnotation.class)
class InternationalizationIntegrationTest {
    
    @Test
    @Order(1)
    void testKoreanErrorMessage() throws Exception {
        mockMvc.perform(get("/api/boards/999")
                .param("lang", "ko"))
            .andExpect(status().isNotFound())
            .andExpect(jsonPath("$.detail").value(containsString("게시글을 찾을 수 없습니다")));
    }
    
    @Test  
    @Order(2)
    void testEnglishErrorMessage() throws Exception {
        mockMvc.perform(get("/api/boards/999")
                .param("lang", "en"))
            .andExpected(status().isNotFound())
            .andExpect(jsonPath("$.detail").value(containsString("Board not found")));
    }
}
```

## 🔧 Advanced Configuration

### Custom Locale Resolution

현재는 쿼리 파라미터만 지원하지만, 헤더 기반 해결도 추가할 수 있습니다:

```java
@Configuration
public class AdvancedInternationalizationConfig {
    
    @Bean
    public LocaleResolver localeResolver() {
        AcceptHeaderLocaleResolver resolver = new AcceptHeaderLocaleResolver();
        resolver.setDefaultLocale(Locale.KOREAN);
        resolver.setSupportedLocales(Arrays.asList(
            Locale.KOREAN, 
            Locale.ENGLISH,
            Locale.JAPANESE,
            Locale.CHINESE
        ));
        return resolver;
    }
}
```

### Message Caching

성능 최적화를 위한 캐싱 설정:

```java
@Bean
public MessageSource messageSource() {
    ReloadableResourceBundleMessageSource messageSource = 
        new ReloadableResourceBundleMessageSource();
    messageSource.setCacheSeconds(300);      // 5분 캐시
    messageSource.setUseCodeAsDefaultMessage(true);  // 키를 기본 메시지로 사용
    return messageSource;
}
```

### Dynamic Message Updates

개발 환경에서 메시지 파일을 실시간으로 업데이트하려면:

```properties
# application-dev.properties
spring.messages.cache-duration=PT1S  # 1초 캐시 (개발 환경)
```

## 🛠 Development Best Practices

### Message Key Management

#### Consistent Naming
```properties
# ✅ Good: 일관된 명명 규칙
error.user.not-found=...
error.board.not-found=... 
error.comment.not-found=...

# ❌ Bad: 불일치하는 명명
error.user.notFound=...
error.board.missing=...
error.no.comment=...
```

#### Hierarchical Organization
```properties
# 계층적 구조로 관리
# Authentication errors
error.auth.required=인증이 필요합니다
error.auth.invalid-credentials=잘못된 인증 정보입니다
error.auth.token-expired=토큰이 만료되었습니다

# Validation errors  
validation.user.username.required=사용자명은 필수입니다
validation.user.username.size=사용자명은 {min}자 이상 {max}자 이하여야 합니다
validation.user.email.invalid=올바른 이메일 형식이 아닙니다

# Business logic errors
business.board.max-posts-reached=일일 게시글 작성 한도에 도달했습니다
business.user.account-locked=계정이 잠겨 있습니다
```

### Code Guidelines

#### Exception Message Patterns
```java
// ✅ Good: 일관된 예외 메시지 사용
throw new ResourceNotFoundException(
    MessageUtils.getMessageStatic("error.board.not-found", boardId)
);

// ❌ Bad: 하드코딩된 메시지
throw new ResourceNotFoundException("Board not found: " + boardId);
```

#### Validation Message Patterns
```java
// ✅ Good: 메시지 키 사용
@NotBlank(message = "{validation.board.title.required}")
private String title;

// ❌ Bad: 하드코딩된 메시지
@NotBlank(message = "Title is required")
private String title;
```

## 📝 Message File Maintenance

### File Structure
```
src/main/resources/
├── messages.properties              # 기본 메시지 (한국어)
├── messages_ko.properties           # 한국어 명시적 설정
├── messages_en.properties           # 영어 메시지
├── messages_ja.properties           # 일본어 메시지 (향후)
├── ValidationMessages.properties    # 기본 유효성 검증 메시지
├── ValidationMessages_ko.properties # 한국어 유효성 검증
└── ValidationMessages_en.properties # 영어 유효성 검증
```

### Translation Workflow

1. **Base Message**: `messages_ko.properties`에 한국어 메시지 추가
2. **English Translation**: `messages_en.properties`에 영어 번역 추가
3. **Validation**: 두 언어 모두에서 테스트
4. **Documentation**: 새로운 메시지 키 문서화

### Quality Assurance

#### Translation Checklist
- [ ] 문법적으로 정확한 번역
- [ ] 문화적으로 적절한 표현
- [ ] 매개변수 순서 확인 (`{0}`, `{1}`)
- [ ] 특수 문자 이스케이프 확인
- [ ] 메시지 길이 적절성 (UI 제약 고려)

#### Testing Checklist
- [ ] 두 언어에서 모든 에러 시나리오 테스트
- [ ] 매개변수가 올바르게 치환되는지 확인
- [ ] fallback 메커니즘 동작 확인
- [ ] 성능 테스트 (메시지 로딩 시간)

## 🔍 Troubleshooting

### Common Issues

#### Missing Message Key
```
# 에러 로그
Could not resolve message with key 'error.new.feature' in locale 'en'

# 해결법
1. messages_en.properties에 키 추가
2. 또는 useCodeAsDefaultMessage=true 설정으로 키를 기본 메시지로 사용
```

#### Encoding Issues
```
# 한글이 깨져서 나오는 경우
1. 파일 인코딩이 UTF-8인지 확인
2. MessageSource 설정에서 defaultEncoding="UTF-8" 확인
3. IDE 파일 인코딩 설정 확인
```

#### Performance Issues
```
# 메시지 로딩이 느린 경우  
1. 캐시 시간 늘리기: setCacheSeconds(3600)
2. 메시지 파일 크기 확인
3. 불필요한 메시지 정리
```

### Debug Tips

```yaml
# 디버그 로깅 활성화
logging.level.org.springframework.context.support.ReloadableResourceBundleMessageSource=DEBUG
logging.level.bunny.boardhole.common.util.MessageUtils=DEBUG
```

## 🚀 Future Enhancements

### Planned Features

- **🌐 Accept-Language Header**: HTTP 헤더 기반 언어 감지
- **🍪 Cookie Support**: 언어 설정 쿠키 저장
- **🔄 Real-time Switching**: 세션 중 실시간 언어 변경
- **📊 Usage Analytics**: 언어별 사용 통계
- **🤖 Auto-translation**: 자동 번역 도구 연동

### Contributing New Languages

새로운 언어 추가에 관심이 있으시면:

1. [Issues](https://github.com/your-username/board-hole/issues)에 언어 추가 요청
2. 번역 작업 자원봉사
3. 문화적 적절성 검토 참여

---

**💡 다국어 지원 관련 문의는 [GitHub Issues](https://github.com/your-username/board-hole/issues)에 `i18n` 라벨로 남겨주세요!**